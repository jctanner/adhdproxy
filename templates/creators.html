{% extends "base.html" %}

{% block title %}Creators{% endblock %}
{% block nav_creators %}active{% endblock %}

{% block content %}
<h1>Cached Creators ({{ creators|length }})</h1>

<div style="margin-bottom: 15px; padding: 15px; background: #ecf0f1; border-radius: 3px;">
    <input type="text" id="creatorFilter" placeholder="Filter creators..." style="width: 300px; margin-right: 10px;" onkeyup="filterCreators()">
    <select id="creatorSort" onchange="sortCreators()" style="margin-right: 10px;">
        <option value="count">Sort by video count</option>
        <option value="alpha">Sort alphabetically</option>
        <option value="recent">Sort by most recent upload</option>
    </select>
    <span id="creatorCount" style="color: #666; font-size: 0.9em;"></span>
</div>

<div id="creatorPagination" style="margin-bottom: 10px;">
    <button onclick="prevCreatorPage()" id="prevCreatorBtn" style="margin-right: 10px;">← Previous</button>
    <span id="creatorPageInfo" style="margin: 0 10px; color: #666;"></span>
    <button onclick="nextCreatorPage()" id="nextCreatorBtn">Next →</button>
</div>

<div id="creatorGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px; margin-bottom: 30px;">
    {% for creator in creators %}
    <div class="creator-card"
         data-name="{{ creator.name|lower }}"
         data-count="{{ creator.video_count }}"
         data-timestamp="{{ creator.latest_timestamp }}"
         style="padding: 15px; background: #f9f9f9; border-left: 3px solid #3498db; border-radius: 3px;">
        <a href="/youtube/channel/{{ creator.channel_id }}" style="font-weight: bold; font-size: 1.1em;">{{ creator.name }}</a>
        <div style="color: #666; font-size: 0.9em; margin-top: 5px;">
            {{ creator.video_count }} video{% if creator.video_count != 1 %}s{% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<script>
var currentCreatorPage = 1;
var creatorsPerPage = 18; // About 6 rows of 3 cards

function getVisibleCards() {
    var cards = Array.from(document.getElementsByClassName('creator-card'));
    return cards.filter(function(card) {
        var filtered = card.getAttribute('data-filtered');
        return filtered === 'visible' || filtered === null;
    });
}

function updateCreatorPagination() {
    var visibleCards = getVisibleCards();
    var totalPages = Math.ceil(visibleCards.length / creatorsPerPage);

    if (currentCreatorPage > totalPages && totalPages > 0) {
        currentCreatorPage = 1;
    }

    visibleCards.forEach(function(card) {
        card.style.display = 'none';
    });

    var startIdx = (currentCreatorPage - 1) * creatorsPerPage;
    var endIdx = Math.min(startIdx + creatorsPerPage, visibleCards.length);

    for (var i = startIdx; i < endIdx; i++) {
        visibleCards[i].style.display = '';
    }

    document.getElementById('creatorPageInfo').textContent =
        'Page ' + currentCreatorPage + ' of ' + (totalPages || 1);
    document.getElementById('prevCreatorBtn').disabled = currentCreatorPage <= 1;
    document.getElementById('nextCreatorBtn').disabled = currentCreatorPage >= totalPages;

    var showingCount = Math.min(endIdx - startIdx, visibleCards.length);
    document.getElementById('creatorCount').textContent =
        'Showing ' + showingCount + ' of ' + visibleCards.length + ' creators';
}

function prevCreatorPage() {
    if (currentCreatorPage > 1) {
        currentCreatorPage--;
        updateCreatorPagination();
    }
}

function nextCreatorPage() {
    var visibleCards = getVisibleCards();
    var totalPages = Math.ceil(visibleCards.length / creatorsPerPage);
    if (currentCreatorPage < totalPages) {
        currentCreatorPage++;
        updateCreatorPagination();
    }
}

function filterCreators() {
    var input = document.getElementById('creatorFilter');
    var filter = input.value.toLowerCase();
    var cards = document.getElementsByClassName('creator-card');

    for (var i = 0; i < cards.length; i++) {
        var name = cards[i].getAttribute('data-name');
        if (name.indexOf(filter) > -1) {
            cards[i].setAttribute('data-filtered', 'visible');
        } else {
            cards[i].setAttribute('data-filtered', 'hidden');
            cards[i].style.display = 'none';
        }
    }

    currentCreatorPage = 1;
    updateCreatorPagination();
}

function sortCreators() {
    var select = document.getElementById('creatorSort');
    var sortBy = select.value;
    var grid = document.getElementById('creatorGrid');
    var cards = Array.from(document.getElementsByClassName('creator-card'));

    cards.sort(function(a, b) {
        if (sortBy === 'alpha') {
            return a.getAttribute('data-name').localeCompare(b.getAttribute('data-name'));
        } else if (sortBy === 'count') {
            return parseInt(b.getAttribute('data-count')) - parseInt(a.getAttribute('data-count'));
        } else if (sortBy === 'recent') {
            return parseInt(b.getAttribute('data-timestamp')) - parseInt(a.getAttribute('data-timestamp'));
        }
    });

    cards.forEach(function(card) {
        grid.appendChild(card);
    });

    updateCreatorPagination();
}

document.addEventListener('DOMContentLoaded', function() {
    var cards = document.getElementsByClassName('creator-card');
    for (var i = 0; i < cards.length; i++) {
        cards[i].setAttribute('data-filtered', 'visible');
    }
    updateCreatorPagination();
});
</script>
{% endblock %}
